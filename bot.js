const PRACTICE_MAP = '{"name":"Futsal No Goals from HaxMaps","width":420,"height":200,"spawnDistance":180,"bg":{"type":"hockey","width":368,"height":171,"kickOffRadius":65,"cornerRadius":0},"vertexes":[{"x":-368,"y":171,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":-368,"y":65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":-368,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":-368,"y":-171,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":171,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":-171,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":-65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":171,"bCoef":1,"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":-171,"bCoef":1,"trait":"ballArea","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":171,"bCoef":0,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":-171,"bCoef":0,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":-65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":377,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"line"},{"x":377,"y":-171,"bCoef":1,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":-377,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"line"},{"x":-377,"y":-171,"bCoef":1,"cMask":["ball"],"trait":"ballArea"},{"x":-377,"y":65,"bCoef":1,"cMask":["ball"],"trait":"line"},{"x":-377,"y":171,"bCoef":1,"cMask":["ball"],"trait":"ballArea"},{"x":377,"y":65,"bCoef":1,"cMask":["ball"],"trait":"line"},{"x":377,"y":171,"bCoef":1,"cMask":["ball"],"trait":"ballArea"},{"x":0,"y":65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":0,"y":-65,"trait":"line","_data":{"mirror":{}},"color":"B6B6B6"},{"x":-368.53340356886,"y":-62.053454903872,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,-80],"_data":{"mirror":{}}},{"x":-400.05760771891,"y":-62.053454903872,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,-80],"_data":{"mirror":{}}},{"x":-400.05760771891,"y":64.043361696331,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,80],"_data":{"mirror":{}}},{"x":-368.53340356886,"y":64.043361696331,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,80],"_data":{"mirror":{}}},{"x":368.09926357786,"y":63.94882446641,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,-80],"_data":{"mirror":{}}},{"x":400,"y":64,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,-80],"_data":{"mirror":{}}},{"x":400,"y":-61.927767991658,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,80],"_data":{"mirror":{}}},{"x":368.9681846993,"y":-62.144998272018,"cMask":["red","blue","ball"],"trait":"goalNet","curve":0,"color":"B6B6B6","pos":[-700,80],"_data":{"mirror":{}}},{"x":-368,"y":-142.37229643041,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":-90,"_data":{"mirror":{}}},{"x":-260.90035258157,"y":-50.168480548544,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":0,"_data":{"mirror":{}}},{"x":-368,"y":-160.81305960678,"bCoef":0.1,"trait":"line","curve":-90,"_data":{"mirror":{}},"_selected":"segment","color":"B6B6B6"},{"x":-358.5379338963,"y":-171,"bCoef":0.1,"trait":"line","curve":-90,"_data":{"mirror":{}},"_selected":"segment","color":"B6B6B6"},{"x":-368,"y":141.33175243687,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":90,"_data":{"mirror":{}}},{"x":-260.90035258157,"y":49.127936555002,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":0,"_data":{"mirror":{}}},{"x":-368,"y":159.77251561324,"bCoef":0.1,"trait":"line","curve":90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":-358.5379338963,"y":171,"bCoef":0.1,"trait":"line","curve":90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":159.77251561324,"bCoef":0.1,"trait":"line","curve":-90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":358.36266315432,"y":171,"bCoef":0.1,"trait":"line","curve":-90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":-160.81305960678,"bCoef":0.1,"trait":"line","curve":90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":358.36266315432,"y":-171,"bCoef":0.1,"trait":"line","curve":90,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":368,"y":-142.37229643041,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":90,"_data":{"mirror":{}}},{"x":260.72508183959,"y":-50.168480548544,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":90,"_data":{"mirror":{}}},{"x":368,"y":141.33175243687,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":-90,"_data":{"mirror":{}}},{"x":260.72508183959,"y":49.127936555002,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":-90,"_data":{"mirror":{}}},{"x":260.72508183959,"y":-50.168480548544,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":0,"_data":{"mirror":{}}},{"x":260.72508183959,"y":49.127936555002,"bCoef":0.1,"trait":"line","color":"B6B6B6","curve":0,"_data":{"mirror":{}}},{"x":-250.86909422732,"y":-1.2295321189394,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":0.18898812539692,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":-2.6480523632758,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":1.6075083697333,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":0.89824824756514,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":-1.9387922411076,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":1.9621384308174,"bCoef":0.1,"trait":"line","curve":180},{"x":-250.86909422732,"y":-3.0026824243599,"bCoef":0.1,"trait":"line","curve":180},{"x":250.69382348534,"y":-1.2295321189394,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":0.18898812539692,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":-2.6480523632758,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":1.6075083697333,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":0.89824824756514,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":-1.9387922411076,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":1.9621384308174,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":250.69382348534,"y":-3.0026824243599,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":-185.66591492467,"y":-1.2295321189394,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":0.18898812539692,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":-2.6480523632758,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":1.6075083697333,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":0.89824824756514,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":-1.9387922411076,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":1.9621384308174,"bCoef":0.1,"trait":"line","curve":180},{"x":-185.66591492467,"y":-3.0026824243599,"bCoef":0.1,"trait":"line","curve":180},{"x":185.49064418269,"y":-1.2295321189394,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":0.18898812539692,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":-2.6480523632758,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":1.6075083697333,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":0.89824824756514,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":-1.9387922411076,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":1.9621384308174,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":185.49064418269,"y":-3.0026824243599,"bCoef":0.1,"trait":"line","curve":180,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":369,"y":65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","vis":false,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":369,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","vis":false,"_data":{"mirror":{}},"color":"B6B6B6"},{"x":-370,"y":65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","vis":false,"_data":{"mirror":{}}},{"x":-370,"y":-65,"bCoef":1,"cMask":["ball"],"trait":"ballArea","vis":false,"_data":{"mirror":{}}},{"x":371,"y":-65,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":371,"y":-171,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":371,"y":65,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":371,"y":171,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":-371,"y":65,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":-371,"y":171,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":-371,"y":-65,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}},{"x":-371,"y":-171,"bCoef":0,"cMask":["ball"],"trait":"ballArea","_data":{"mirror":{}}}],"segments":[{"v0":0,"v1":1,"trait":"ballArea"},{"v0":2,"v1":3,"trait":"ballArea"},{"v0":4,"v1":5,"trait":"ballArea"},{"v0":6,"v1":7,"trait":"ballArea"},{"v0":8,"v1":9,"curve":180,"cGroup":["blueKO"],"trait":"line","_data":{"mirror":{},"arc":{"a":[0,65],"b":[0,-65],"curve":180,"radius":65,"center":[0,0],"from":1.5707963267948966,"to":-1.5707963267948966}},"color":"B6B6B6"},{"v0":8,"v1":9,"curve":-180,"cGroup":["redKO"],"trait":"line","_data":{"mirror":{},"arc":{"a":[0,65],"b":[0,-65],"curve":-180,"radius":65,"center":[0,0],"from":-1.5707963267948966,"to":1.5707963267948966}},"color":"B6B6B6"},{"v0":1,"v1":0,"vis":true,"color":"B6B6B6","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":-368,"_data":{"mirror":{},"arc":{"a":[-368,65],"b":[-368,171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":5,"v1":4,"vis":true,"color":"B6B6B6","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":368,"_data":{"mirror":{},"arc":{"a":[368,65],"b":[368,171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":2,"v1":3,"vis":true,"color":"B6B6B6","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":-368,"_data":{"mirror":{},"arc":{"a":[-368,-65],"b":[-368,-171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":6,"v1":7,"vis":true,"color":"B6B6B6","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":368,"_data":{"mirror":{},"arc":{"a":[368,-65],"b":[368,-171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":0,"v1":10,"vis":true,"color":"B6B6B6","bCoef":1,"trait":"ballArea","y":171,"_data":{"mirror":{},"arc":{"a":[-368,171],"b":[368,171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":3,"v1":11,"vis":true,"color":"B6B6B6","bCoef":1,"trait":"ballArea","y":-171,"_data":{"mirror":{},"arc":{"a":[-368,-171],"b":[368,-171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":12,"v1":13,"curve":0,"vis":true,"color":"B6B6B6","bCoef":0,"trait":"line","_data":{"mirror":{},"arc":{"a":[0,171],"b":[0,-171],"curve":0}}},{"v0":9,"v1":8,"curve":-180,"vis":true,"color":"B6B6B6","bCoef":0,"trait":"line","_data":{"mirror":{},"arc":{"a":[0,-65],"b":[0,65],"curve":-180,"radius":65,"center":[0,0],"from":1.5707963267948966,"to":-1.5707963267948966}}},{"v0":15,"v1":14,"curve":180,"vis":true,"color":"B6B6B6","bCoef":0,"trait":"line","_data":{"mirror":{},"arc":{"a":[0,-65],"b":[0,65],"curve":180,"radius":65,"center":[0,0],"from":-1.5707963267948966,"to":1.5707963267948966}}},{"v0":2,"v1":1,"curve":0,"vis":true,"color":"B6B6B6","bCoef":1,"trait":"ballArea","_data":{"mirror":{},"arc":{"a":[-368,-65],"b":[-368,65],"curve":0}}},{"v0":6,"v1":5,"curve":0,"vis":true,"color":"B6B6B6","bCoef":1,"trait":"ballArea","_data":{"mirror":{},"arc":{"a":[368,-65],"b":[368,65],"curve":0}}},{"v0":16,"v1":17,"vis":false,"color":"FFFFFF","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":330},{"v0":18,"v1":19,"vis":false,"color":"FFFFFF","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":-330},{"v0":20,"v1":21,"vis":false,"color":"FFFFFF","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":-330},{"v0":22,"v1":23,"vis":false,"color":"FFFFFF","bCoef":1,"cMask":["ball"],"trait":"ballArea","x":330},{"v0":26,"v1":27,"curve":0,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","pos":[-700,-80],"y":-80,"_data":{"mirror":{},"arc":{"a":[-368.53340356886,-62.053454903872],"b":[-400.05760771891,-62.053454903872],"curve":0}}},{"v0":27,"v1":28,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","x":-590,"_data":{"mirror":{},"arc":{"a":[-400.05760771891,-62.053454903872],"b":[-400.05760771891,64.043361696331],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":28,"v1":29,"curve":0,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","pos":[-700,80],"y":80,"_data":{"mirror":{},"arc":{"a":[-400.05760771891,64.043361696331],"b":[-368.53340356886,64.043361696331],"curve":0}}},{"v0":30,"v1":31,"curve":0,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","pos":[-700,-80],"y":-80,"_data":{"mirror":{},"arc":{"a":[368.09926357786,63.94882446641],"b":[400,64],"curve":0}}},{"v0":31,"v1":32,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","x":-590,"_data":{"mirror":{},"arc":{"a":[400,64],"b":[400,-61.927767991658],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":32,"v1":33,"curve":0,"color":"B6B6B6","cMask":["red","blue","ball"],"trait":"goalNet","pos":[-700,80],"y":80,"_data":{"mirror":{},"arc":{"a":[400,-61.927767991658],"b":[368.9681846993,-62.144998272018],"curve":0}}},{"v0":34,"v1":35,"curve":94.0263701017,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[-368,-142.37229643041],"b":[-260.90035258157,-50.168480548544],"curve":94.0263701017,"radius":96.59592804010063,"center":[-357.4210706141604,-46.35740400752737],"from":-1.680533785990688,"to":-0.039464044017267254}}},{"v0":37,"v1":36,"curve":86.632306418889,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[-358.5379338963,-171],"b":[-368,-160.81305960678],"curve":86.632306418889,"radius":10.133324123772063,"center":[-368.6709741036765,-170.92414518398766],"from":-0.007485749348334191,"to":1.5045332362578945}},"_selected":true},{"v0":38,"v1":39,"curve":-94.026370101699,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[-368,141.33175243687],"b":[-260.90035258157,49.127936555002],"curve":-94.026370101699,"radius":96.59592804010232,"center":[-357.4210706141621,45.3168600139855],"from":0.03946404401726531,"to":1.6805337859906682}}},{"v0":35,"v1":39,"curve":0,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[-260.90035258157,-50.168480548544],"b":[-260.90035258157,49.127936555002],"curve":0}}},{"v0":41,"v1":40,"curve":-86.632306418888,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[-358.5379338963,171],"b":[-368,159.77251561324],"curve":-86.632306418888,"radius":10.701444282878198,"center":[-369.2227615768304,170.40387318721773],"from":-1.4562848685215513,"to":0.05573411708465988}}},{"v0":43,"v1":42,"curve":86.632306418884,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[358.36266315432,171],"b":[368,159.77251561324],"curve":86.632306418884,"radius":10.784208513218907,"center":[369.1351262058408,170.49681707083602],"from":3.0949164708863495,"to":-1.67624985068709}}},{"v0":45,"v1":44,"curve":-86.632306418899,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[358.36266315432,-171],"b":[368,-160.81305960678],"curve":-86.632306418899,"radius":10.220689864898038,"center":[368.58333873268555,-171.0170890676047],"from":1.6279016599493925,"to":3.1399206455557964}}},{"v0":46,"v1":47,"curve":-94.026370101699,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[368,-142.37229643041],"b":[260.72508183959,-50.168480548544],"curve":-94.026370101699,"radius":96.68674950035353,"center":[357.33343524317115,-46.27572039758512],"from":-3.101320200238848,"to":-1.460250458265445}}},{"v0":48,"v1":49,"curve":94.026370101699,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","_data":{"mirror":{},"arc":{"a":[368,141.33175243687],"b":[260.72508183959,49.127936555002],"curve":94.026370101699,"radius":96.68674950035444,"center":[357.33343524317206,45.23517640404413],"from":1.4602504582654556,"to":3.101320200238859}}},{"v0":50,"v1":51,"curve":0,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":390,"_data":{"mirror":{},"arc":{"a":[260.72508183959,-50.168480548544],"b":[260.72508183959,49.127936555002],"curve":0}}},{"v0":53,"v1":52,"curve":-180.00692920292,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":52,"v1":53,"curve":-180.00218240614,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":55,"v1":54,"curve":-179.64823645332,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":54,"v1":55,"curve":-180.35758668147,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":57,"v1":56,"curve":-180.02357323962,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":56,"v1":57,"curve":-180.00924102399,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":59,"v1":58,"curve":-180.06885755885,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":58,"v1":59,"curve":-180.02948353257,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-375},{"v0":61,"v1":60,"curve":-179.99869069543,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,0.18898812539692],"b":[250.69382348534,-1.2295321189394],"curve":-179.99869069543,"radius":0.7092601222106558,"center":[250.69381538145066,-0.5202719967712399],"from":-1.5707849009595944,"to":1.5707849009595944}}},{"v0":60,"v1":61,"curve":-179.99939258776,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,-1.2295321189394],"b":[250.69382348534,0.18898812539692],"curve":-179.99939258776,"radius":0.7092601221699308,"center":[250.6938272448944,-0.52027199677124],"from":1.5708016274656738,"to":-1.5708016274656738}}},{"v0":63,"v1":62,"curve":-180.08826047163,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,1.6075083697333],"b":[250.69382348534,-2.6480523632758],"curve":-180.08826047163,"radius":2.1277809976424447,"center":[250.69546234022081,-0.5202719967712501],"from":-1.5715665447095521,"to":1.5715665447095521}}},{"v0":62,"v1":63,"curve":-179.91186753664,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,-2.6480523632758],"b":[250.69382348534,1.6075083697333],"curve":-179.91186753664,"radius":2.1277809958126963,"center":[250.69545996331237,-0.5202719967712499],"from":1.571565427626666,"to":-1.571565427626666}}},{"v0":65,"v1":64,"curve":-179.99528711105,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,-1.9387922411076],"b":[250.69382348534,0.89824824756514],"curve":-179.99528711105,"radius":1.4185202455339638,"center":[250.6938818258353,-0.52027199677123],"from":1.5708374545091373,"to":-1.5708374545091373}}},{"v0":64,"v1":65,"curve":-179.99743836358,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,0.89824824756514],"b":[250.69382348534,-1.9387922411076],"curve":-179.99743836358,"radius":1.4185202446869185,"center":[250.69379177503876,-0.5202719967712299],"from":-1.5707739723016387,"to":1.5707739723016387}}},{"v0":67,"v1":66,"curve":-179.98626041101,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,-3.0026824243599],"b":[250.69382348534,1.9621384308174],"curve":-179.98626041101,"radius":2.4824104454311193,"center":[250.69412112767628,-0.5202719967712501],"from":1.5709162273284845,"to":-1.5709162273284845}}},{"v0":66,"v1":67,"curve":-179.99175181595,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":375,"_data":{"mirror":{},"arc":{"a":[250.69382348534,1.9621384308174],"b":[250.69382348534,-3.0026824243599],"curve":-179.99175181595,"radius":2.4824104340171904,"center":[250.69364480395592,-0.5202719967712501],"from":-1.570724347809556,"to":1.570724347809556}}},{"v0":69,"v1":68,"curve":-180.04715562398,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":68,"v1":69,"curve":-179.95294709391,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":71,"v1":70,"curve":-179.95715750564,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":70,"v1":71,"curve":-179.89943871875,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":73,"v1":72,"curve":-179.94773754738,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":72,"v1":73,"curve":-179.98221351296,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":75,"v1":74,"curve":-180.4151727218,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":74,"v1":75,"curve":-179.58764458796,"vis":true,"color":"F8F8F8","bCoef":0.1,"trait":"line","x":-277.5},{"v0":77,"v1":76,"curve":-180.00086646359,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,0.18898812539692],"b":[185.49064418269,-1.2295321189394],"curve":-180.00086646359,"radius":0.7092601221941792,"center":[185.4906495456384,-0.5202719967712399],"from":-1.570803888122867,"to":1.570803888122867}}},{"v0":76,"v1":77,"curve":-180.01965986376,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,-1.2295321189394],"b":[185.49064418269,0.18898812539692],"curve":-180.01965986376,"radius":0.7092601326067499,"center":[185.49052249870462,-0.52027199677124],"from":1.5706247621173026,"to":-1.5706247621173026}}},{"v0":79,"v1":78,"curve":-180.03532601389,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,1.6075083697333],"b":[185.49064418269,-2.6480523632758],"curve":-180.03532601389,"radius":2.1277804676118817,"center":[185.49130012979094,-0.5202719967712501],"from":-1.5711046044209547,"to":1.5711046044209547}}},{"v0":78,"v1":79,"curve":-179.99380079,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,-2.6480523632758],"b":[185.49064418269,1.6075083697333],"curve":-179.99380079,"radius":2.127780369615752,"center":[185.49075929201425,-0.5202719967712499],"from":1.570850425105954,"to":-1.570850425105954}}},{"v0":81,"v1":80,"curve":-180.0044468452,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,-1.9387922411076],"b":[185.49064418269,0.89824824756514],"curve":-180.0044468452,"radius":1.4185202454066896,"center":[185.49058913552548,-0.52027199677123],"from":1.5707575207470346,"to":-1.5707575207470346}}},{"v0":80,"v1":81,"curve":-180.01386779847,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,0.89824824756514],"b":[185.49064418269,-1.9387922411076],"curve":-180.01386779847,"radius":1.4185202547246905,"center":[185.49081585111898,-0.5202719967712299],"from":-1.5709173461661912,"to":1.5709173461661912}}},{"v0":83,"v1":82,"curve":-180.05158287563,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,-3.0026824243599],"b":[185.49064418269,1.9621384308174],"curve":-180.05158287563,"radius":2.482410679095637,"center":[185.48952673670945,-0.5202719967712501],"from":1.570346181286056,"to":-1.570346181286056}}},{"v0":82,"v1":83,"curve":-180.01212223878,"vis":true,"color":"B6B6B6","bCoef":0.1,"trait":"line","x":277.5,"_data":{"mirror":{},"arc":{"a":[185.49064418269,1.9621384308174],"b":[185.49064418269,-3.0026824243599],"curve":-180.01212223878,"radius":2.4824104414801433,"center":[185.49090678817686,-0.5202719967712501],"from":-1.5709021132848964,"to":1.5709021132848964}}},{"v0":85,"v1":84,"curve":0,"vis":false,"color":"B6B6B6","bCoef":1,"trait":"ballArea","x":369,"_data":{"mirror":{},"arc":{"a":[369,-65],"b":[369,65],"curve":0}}},{"v0":87,"v1":86,"curve":0,"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","x":-370,"_data":{"mirror":{},"arc":{"a":[-370,-65],"b":[-370,65],"curve":0}}},{"v0":88,"v1":89,"vis":false,"color":"FFFFFF","bCoef":0,"cMask":["ball"],"trait":"ballArea","x":371,"_data":{"mirror":{},"arc":{"a":[371,-65],"b":[371,-171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":90,"v1":91,"vis":false,"color":"FFFFFF","bCoef":0,"cMask":["ball"],"trait":"ballArea","x":371,"_data":{"mirror":{},"arc":{"a":[371,65],"b":[371,171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":92,"v1":93,"vis":false,"color":"FFFFFF","bCoef":0,"cMask":["ball"],"trait":"ballArea","x":-371,"_data":{"mirror":{},"arc":{"a":[-371,65],"b":[-371,171],"radius":null,"center":[null,null],"from":null,"to":null}}},{"v0":94,"v1":95,"vis":false,"color":"FFFFFF","bCoef":0,"cMask":["ball"],"trait":"ballArea","x":-371,"_data":{"mirror":{},"arc":{"a":[-371,-65],"b":[-371,-171],"radius":null,"center":[null,null],"from":null,"to":null}}}],"goals":[{"p0":[-374.25,-62.053454903872],"p1":[-374.25,64.043361696331],"team":"red","_data":{"mirror":{}}},{"p0":[374.25,62],"p1":[374.25,-62],"team":"blue"}],"discs":[{"radius":3.9405255187564,"pos":[-368.53340356886,64.043361696331],"color":"FFCC00","trait":"goalPost","y":80,"_data":{"mirror":{}}},{"radius":3.9405255187564,"pos":[-368.53340356886,-62.053454903872],"color":"FFCC00","trait":"goalPost","y":-80,"x":-560,"_data":{"mirror":{}}},{"radius":3.9405255187564,"pos":[368.9681846993,-62.144998272018],"color":"FFCC00","trait":"goalPost","y":80,"_data":{"mirror":{}}},{"radius":3.9405255187564,"pos":[368.09926357786,63.94882446641],"color":"FFCC00","trait":"goalPost","y":-80,"x":-560,"_data":{"mirror":{}}},{"radius":3,"invMass":0,"pos":[-368,-171],"color":"FFCC00","bCoef":0.1,"trait":"line","_data":{"mirror":{}}},{"radius":3,"invMass":0,"pos":[-368,171],"color":"FFCC00","bCoef":0.1,"trait":"line"},{"radius":3,"invMass":0,"pos":[368,171],"color":"FFCC00","bCoef":0.1,"trait":"line"},{"radius":3,"invMass":0,"pos":[368,-171],"color":"FFCC00","bCoef":0.1,"trait":"line","_data":{"mirror":{}}}],"planes":[{"normal":[0,1],"dist":-171,"trait":"ballArea","_data":{"extremes":{"normal":[0,1],"dist":-171,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[-510.97393689986274,-171],"b":[510.97393689986274,-171]}}},{"normal":[0,-1],"dist":-171,"trait":"ballArea","_data":{"extremes":{"normal":[0,-1],"dist":-171,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[-510.97393689986274,171],"b":[510.97393689986274,171]}}},{"normal":[0,1],"dist":-200,"bCoef":0.2,"cMask":["all"],"_data":{"extremes":{"normal":[0,1],"dist":-200,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[-510.97393689986274,-200],"b":[510.97393689986274,-200]}}},{"normal":[0,-1],"dist":-200,"bCoef":0.2,"cMask":["all"],"_data":{"extremes":{"normal":[0,-1],"dist":-200,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[-510.97393689986274,200],"b":[510.97393689986274,200]}}},{"normal":[1,0],"dist":-420,"bCoef":0.2,"cMask":["all"],"_data":{"extremes":{"normal":[1,0],"dist":-420,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[-420,-171.46776406035661],"b":[-420,171.46776406035661]}}},{"normal":[-1,0],"dist":-420,"bCoef":0.2,"cMask":["all"],"_data":{"extremes":{"normal":[-1,0],"dist":-420,"canvas_rect":[-510.97393689986274,-171.46776406035661,510.97393689986274,171.46776406035661],"a":[420,-171.46776406035661],"b":[420,171.46776406035661]}}}],"traits":{"ballArea":{"vis":false,"bCoef":1,"cMask":["ball"]},"goalPost":{"radius":8,"invMass":0,"bCoef":1},"goalNet":{"vis":true,"bCoef":0.1,"cMask":["all"]},"kickOffBarrier":{"vis":false,"bCoef":0.1,"cGroup":["redKO","blueKO"],"cMask":["red","blue"]},"line":{"vis":true,"bCoef":0,"cMask":[""]},"arco":{"radius":2,"cMask":["n\/d"],"color":"cccccc"}},"playerPhysics":{"acceleration":0.11,"kickingAcceleration":0.083,"kickStrength":5,"bCoef":0},"ballPhysics":{"radius":6.25,"color":"FFCC00","bCoef":0.4,"invMass":1.5,"damping":0.99},"joints":[],"redSpawnPoints":[],"blueSpawnPoints":[],"canBeStored":false}'

const MAP_V1 = '{"name":"TurkHax 1v1","width":420,"height":200,"spawnDistance":180,"bg":{"type":"hockey","width":368,"height":171,"kickOffRadius":65,"cornerRadius":0},"vertexes":[{"x":-368,"y":171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-368,"y":65,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-368,"y":-65,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-368,"y":-171,"trait":"ballArea","bCoef":1,"cMask":["ball"]},{"x":368,"y":171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":368,"y":65,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":368,"y":-65,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":368,"y":-171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":0,"y":65,"trait":"kickOffBarrier"},{"x":0,"y":-65,"trait":"line"},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":-384,"y":-65},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":384,"y":-65},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":-384,"y":65},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":384,"y":65},{"bCoef":1,"trait":"ballArea","x":368,"y":171},{"bCoef":1,"trait":"ballArea","x":368,"y":-171},{"bCoef":0,"trait":"line","x":0,"y":171},{"bCoef":0,"trait":"line","x":0,"y":-171},{"x":0,"y":65,"trait":"kickOffBarrier"},{"x":0,"y":-65,"trait":"kickOffBarrier"},{"x":377,"y":-65,"trait":"line","cMask":["ball"],"bCoef":1},{"x":377,"y":-171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-377,"y":-65,"trait":"line","cMask":["ball"],"bCoef":1},{"x":-377,"y":-171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-377,"y":65,"trait":"line","cMask":["ball"],"bCoef":1},{"x":-377,"y":171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":377,"y":65,"trait":"line","cMask":["ball"],"bCoef":1},{"x":377,"y":171,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":0,"y":199,"trait":"kickOffBarrier"},{"x":0,"y":65,"trait":"kickOffBarrier"},{"x":0,"y":-65,"trait":"kickOffBarrier"},{"x":0,"y":-199,"trait":"kickOffBarrier"}],"segments":[{"v0":0,"v1":1,"trait":"ballArea"},{"v0":2,"v1":3,"trait":"ballArea"},{"v0":4,"v1":5,"trait":"ballArea"},{"v0":6,"v1":7,"trait":"ballArea"},{"v0":8,"v1":9,"trait":"kickOffBarrier","curve":180,"cGroup":["blueKO"]},{"v0":8,"v1":9,"trait":"kickOffBarrier","curve":-180,"cGroup":["redKO"]},{"vis":true,"bCoef":0.1,"cMask":["all"],"trait":"goalNet","v0":2,"v1":10,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["all"],"trait":"goalNet","v0":6,"v1":11,"color":"FFFFFF","curve":35},{"vis":true,"bCoef":0.1,"cMask":["all"],"trait":"goalNet","v0":1,"v1":12,"color":"FFFFFF","curve":35},{"vis":true,"bCoef":0.1,"cMask":["all"],"trait":"goalNet","v0":5,"v1":13,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":10,"v1":12,"x":-585,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":11,"v1":13,"x":585,"color":"FFFFFF","curve":35},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":1,"v1":0,"cMask":["ball"],"x":-368},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":5,"v1":4,"cMask":["ball"],"x":368},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":2,"v1":3,"cMask":["ball"],"x":-368},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":6,"v1":7,"cMask":["ball"],"x":368},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":0,"v1":14,"y":171},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":3,"v1":15,"y":-171},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":16,"v1":17},{"curve":-180,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":9,"v1":8},{"curve":180,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":19,"v1":18},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":2,"v1":1},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":6,"v1":5},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":20,"v1":21,"cMask":["ball"],"x":330},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":22,"v1":23,"cMask":["ball"],"x":-330},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":24,"v1":25,"cMask":["ball"],"x":-330},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":26,"v1":27,"cMask":["ball"],"x":330},{"v0":28,"v1":29,"trait":"kickOffBarrier"},{"v0":30,"v1":31,"trait":"kickOffBarrier"}],"goals":[{"p0":[-377,-65],"p1":[-377,65],"team":"red"},{"p0":[377,65],"p1":[377,-65],"team":"blue"}],"discs":[{"pos":[-368,65],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[-368,-65],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[368,65],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[368,-65],"trait":"goalPost","color":"FFFFFF","radius":5}],"planes":[{"normal":[0,1],"dist":-171,"trait":"ballArea"},{"normal":[0,-1],"dist":-171,"trait":"ballArea"},{"normal":[0,1],"dist":-200,"bCoef":0.2,"cMask":["all"]},{"normal":[0,-1],"dist":-200,"bCoef":0.2,"cMask":["all"]},{"normal":[1,0],"dist":-420,"bCoef":0.2,"cMask":["all"]},{"normal":[-1,0],"dist":-420,"bCoef":0.2,"cMask":["all"]}],"traits":{"ballArea":{"vis":false,"bCoef":1,"cMask":["ball"]},"goalPost":{"radius":8,"invMass":0,"bCoef":1},"goalNet":{"vis":true,"bCoef":0.1,"cMask":["all"]},"kickOffBarrier":{"vis":false,"bCoef":0.1,"cGroup":["redKO","blueKO"],"cMask":["red","blue"]},"line":{"vis":true,"bCoef":0,"cMask":[""]},"arco":{"radius":2,"cMask":["n\/d"],"color":"212121"}},"playerPhysics":{"acceleration":0.11,"kickingAcceleration":0.1,"kickStrength":7},"ballPhysics":{"radius":6.4,"color":"FFFFFF"}}'

const SNIPER = '{"name":"Sniper 1v1 by Junior11 from HaxMaps","width":425,"height":200,"spawnDistance":170,"bg":{"type":"hockey","width":0,"height":0,"kickOffRadius":0,"cornerRadius":0},"vertexes":[{"x":-370,"y":170,"trait":"ballArea"},{"x":-370,"y":-170,"trait":"ballArea"},{"x":370,"y":-170,"trait":"ballArea"},{"x":0,"y":-170,"cMask":["wall"],"trait":"kickOffBarrier","color":"FFFFFF"},{"x":-371,"y":-144,"trait":"goalNet","curve":-190,"color":"ff0000"},{"x":-375,"y":-105,"trait":"goalNet","curve":-190,"color":"ff0000"},{"x":370,"y":-143,"trait":"goalNet","curve":190,"color":"ff0000"},{"x":370,"y":-106,"trait":"goalNet","curve":190,"color":"ff0000"},{"x":-370,"y":-38,"bCoef":1,"trait":"goalNet","curve":-190,"color":"FFFFFF"},{"x":-374,"y":35,"trait":"goalNet","curve":-190,"color":"ffffff"},{"x":-375,"y":105,"trait":"goalNet","curve":-190,"color":"ff0000"},{"x":-371,"y":143,"trait":"goalNet","curve":-190,"color":"ff0000"},{"x":50,"y":-200,"bCoef":0.1,"cMask":["blue"],"cGroup":["redKO"],"trait":"kickOffBarrier","curve":0,"vis":true,"color":"000000"},{"x":50,"y":200,"bCoef":0.1,"cMask":["blue"],"cGroup":["redKO"],"trait":"kickOffBarrier","curve":0,"vis":true,"color":"000000"},{"x":370,"y":104,"trait":"goalNet","curve":190,"color":"ff0000"},{"x":370,"y":142,"trait":"goalNet","curve":190,"color":"ff0000"},{"x":370,"y":-37,"trait":"goalNet","curve":190,"color":"ffffff"},{"x":370,"y":39,"trait":"goalNet","curve":190,"color":"ffffff"},{"x":370,"y":142,"bCoef":1,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false},{"x":370,"y":170,"bCoef":1.4,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false,"color":"ffffff"},{"x":-370,"y":146,"bCoef":1.5,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":170,"bCoef":1.5,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":145,"bCoef":1,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":170,"bCoef":1.4,"cMask":["ball"],"trait":"goalNet","curve":0,"vis":false,"color":"ffffff"},{"x":-370,"y":-103,"bCoef":1,"cMask":["ball"],"trait":"goalPost","curve":1},{"x":-371,"y":-34,"bCoef":1,"cMask":["ball"],"trait":"goalPost","curve":1},{"x":-370,"y":-170,"bCoef":1.4,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":-371,"y":-143,"bCoef":1.5,"cMask":["ball"],"trait":"goalPost"},{"x":-370,"y":37,"bCoef":1,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":-370,"y":99,"bCoef":1,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":370,"y":-170,"bCoef":1.4,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":370,"y":-145,"bCoef":1.52,"cMask":["ball"],"trait":"goalPost"},{"x":370,"y":-104,"bCoef":1,"cMask":["ball"],"trait":"goalPost"},{"x":371,"y":-37,"bCoef":1,"cMask":["ball"],"trait":"goalPost"},{"x":-50,"y":-200,"bCoef":0.1,"cMask":["red"],"cGroup":["blueKO"],"trait":"goalPost","curve":0,"vis":true,"color":"000000"},{"x":-50,"y":200,"bCoef":0.1,"cMask":["red"],"cGroup":["blueKO"],"trait":"goalPost","curve":0,"vis":true,"color":"000000"},{"x":370,"y":-152,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":-370,"y":-152,"bCoef":1,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":-370,"y":-95,"bCoef":1,"cMask":["ball"],"trait":"goalNet","color":"FFFFFF"},{"x":370,"y":152,"bCoef":1,"cMask":["ball"],"trait":"goalNet","color":"ffffff"},{"x":370,"y":-96,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":370,"y":-44,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":-370,"y":153,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":370,"y":49,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":370,"y":96,"bCoef":1,"trait":"goalNet","color":"ffffff"},{"x":0,"y":170,"bCoef":0.1,"cMask":["wall"],"color":"FFFFFF"},{"x":-370,"y":-144,"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":-105,"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":-38,"bCoef":1,"trait":"goalNet","curve":0,"color":"000000","vis":false},{"x":-370,"y":35,"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":105,"trait":"goalNet","curve":0,"vis":false},{"x":-370,"y":143,"trait":"goalNet","curve":0,"vis":false},{"x":50,"y":-200,"bCoef":0.1,"cMask":["red"],"cGroup":["red"],"trait":"goalPost","curve":0,"vis":true,"color":"F0FF0F"},{"x":50,"y":200,"bCoef":0.1,"cMask":["red"],"cGroup":["red"],"trait":"goalPost","curve":0,"vis":true,"color":"F0FF0F"},{"x":-50,"y":-200,"bCoef":0.1,"cMask":["blue"],"cGroup":["blue"],"trait":"goalPost","curve":0,"vis":true,"color":"F0FF0F"},{"x":-50,"y":200,"bCoef":0.1,"cMask":["blue"],"cGroup":["blue"],"trait":"goalPost","curve":0,"vis":true,"color":"F0FF0F"}],"segments":[{"v0":4,"v1":5,"curve":-190,"color":"FFFFFF","trait":"goalNet"},{"v0":6,"v1":7,"curve":190,"color":"FFFFFF","trait":"goalNet","x":370},{"v0":8,"v1":9,"curve":-190,"color":"FFFFFF","trait":"goalNet"},{"v0":10,"v1":11,"curve":-190,"color":"FFFFFF","trait":"goalNet"},{"v0":12,"v1":13,"curve":0,"vis":true,"color":"FFFFFF","bCoef":0.1,"cMask":["blue"],"cGroup":["redKO"],"trait":"kickOffBarrier"},{"v0":14,"v1":15,"curve":190,"color":"FFFFFF","trait":"goalNet","x":370},{"v0":16,"v1":17,"curve":190,"color":"ffffff","trait":"goalNet","x":370},{"v0":18,"v1":19,"curve":0,"vis":false,"color":"FFCCCC","bCoef":1,"cMask":["ball"],"trait":"goalNet"},{"v0":20,"v1":21,"curve":0,"vis":false,"color":"FFCCCC","bCoef":1.5,"cMask":["ball"],"trait":"goalNet"},{"v0":22,"v1":23,"curve":0,"vis":false,"color":"FFCCCC","bCoef":1,"cMask":["ball"],"trait":"goalNet"},{"v0":24,"v1":25,"curve":1,"vis":false,"color":"FFCCCC","bCoef":1,"cMask":["ball"],"trait":"goalPost"},{"v0":28,"v1":29,"curve":0,"vis":false,"color":"FFCCCC","bCoef":1,"cMask":["ball"],"trait":"goalPost"},{"v0":32,"v1":33,"curve":0,"vis":false,"color":"FFCCCC","bCoef":1,"cMask":["ball"],"trait":"goalPost"},{"v0":34,"v1":35,"curve":0,"vis":true,"color":"000000","bCoef":0.1,"cMask":["red"],"cGroup":["blueKO"],"trait":"goalPost"},{"v0":30,"v1":36,"vis":true,"color":"ffffff","bCoef":1,"trait":"goalNet","x":370},{"v0":26,"v1":37,"vis":true,"color":"ffffff","bCoef":1,"cMask":["ball"],"trait":"goalNet","x":-370},{"v0":38,"v1":8,"curve":0,"vis":true,"color":"FFFFFF","bCoef":1,"cMask":["ball"],"trait":"goalNet","x":-370},{"v0":39,"v1":19,"curve":0,"vis":true,"color":"ffffff","bCoef":1,"cMask":["ball"],"trait":"goalNet","x":370},{"v0":28,"v1":29,"curve":0,"vis":true,"color":"ffffff","bCoef":1,"cMask":["ball"],"trait":"goalNet","x":-370},{"v0":40,"v1":41,"curve":0,"vis":true,"color":"ffffff","bCoef":1,"trait":"goalNet","x":370},{"v0":42,"v1":23,"curve":0,"vis":true,"color":"ffffff","bCoef":1,"trait":"goalNet","x":-370},{"v0":43,"v1":44,"curve":0,"vis":true,"color":"ffffff","bCoef":1,"trait":"goalNet","x":370},{"v0":23,"v1":19,"curve":0,"vis":true,"color":"ffffff","bCoef":1.4,"cMask":["ball"],"trait":"goalNet"},{"v0":26,"v1":30,"curve":0,"vis":true,"color":"ffffff","bCoef":1.4,"cMask":["ball"],"trait":"goalNet"},{"v0":3,"v1":45,"curve":1.50571568977,"vis":true,"color":"FFFFFF","bCoef":0.1,"cMask":["wall"],"x":0},{"v0":52,"v1":53,"curve":0,"vis":true,"color":"F0FF0F","bCoef":0.1,"cMask":["red"],"cGroup":["red"],"trait":"goalPost"},{"v0":54,"v1":55,"curve":0,"vis":true,"color":"F0FF0F","bCoef":0.1,"cMask":["blue"],"cGroup":["blue"],"trait":"goalPost"}],"goals":[{"p0":[-369,-146],"p1":[-369,-102],"team":"red","color":"000000","x":-370},{"p0":[370,-110],"p1":[370,-150],"team":"blue","x":370,"color":"000000"},{"p0":[-370,-35],"p1":[-370,35],"team":"red","color":"000000","x":-370},{"p0":[-370,103],"p1":[-370,143],"team":"red","color":"000000","x":-370},{"p0":[370,143],"p1":[370,98],"team":"blue","x":370,"color":"000000"},{"p0":[370,35],"p1":[370,-35],"team":"blue","x":370,"color":"000000"}],"discs":[{"pos":[-370,-105],"color":"ffffff","bCoef":0.5,"trait":"goalPost"},{"pos":[-370,-144],"color":"ffffff","bCoef":0.5,"trait":"goalPost"},{"pos":[370,-105],"color":"ffffff","bCoef":0.5,"trait":"goalPost"},{"pos":[370,-143],"color":"FFFFFF","bCoef":0.5,"trait":"goalPost"},{"pos":[-370,35],"color":"ff0000","bCoef":0.5,"trait":"goalPost"},{"pos":[-370,-35],"color":"ff0000","bCoef":0.5,"trait":"goalPost"},{"pos":[-370,143],"color":"ffffff","bCoef":0.5,"trait":"goalPost"},{"pos":[-370,105],"color":"ffffff","bCoef":0.5,"trait":"goalPost"},{"pos":[370,143],"color":"FFFFFF","bCoef":0.5,"trait":"goalPost"},{"pos":[370,104],"color":"FFFFFF","bCoef":0.5,"trait":"goalPost"},{"pos":[370,41],"color":"0000FF","bCoef":0.5,"trait":"goalPost"},{"pos":[370,-35],"color":"0000FF","bCoef":0.5,"trait":"goalPost"}],"planes":[{"normal":[0,-1],"dist":-170,"bCoef":1,"trait":"ballArea"},{"normal":[0,1],"dist":-170,"bCoef":1,"cMask":["ball"],"trait":"ballArea"},{"normal":[1,0],"dist":-423.311779142,"bCoef":0.1},{"normal":[-1,0],"dist":-423.310955619,"bCoef":0.1},{"normal":[0,-1],"dist":-200,"bCoef":0.1},{"normal":[0,1],"dist":-200,"bCoef":0.1}],"traits":{"ballArea":{"vis":false,"bCoef":1,"cMask":["ball"]},"goalPost":{"radius":8,"invMass":0,"bCoef":0.5},"goalNet":{"vis":true,"bCoef":0.1,"cMask":["ball"]},"kickOffBarrier":{"vis":false,"bCoef":0.1,"cGroup":["redKO","blueKO"],"cMask":["red","blue"]}},"playerPhysics":{"bCoef":0.5,"invMass":0.5,"damping":0.96,"acceleration":0.12,"kickingAcceleration":0.12,"kickingDamping":0.96,"kickStrength":13},"ballPhysics":{"color":"66666F","radius":10}}'

const MAP_V3 = '{"name":"Futsal 3v3 Zimska Liga from HaxMaps","width":755,"height":339,"spawnDistance":310,"bg":{"type":"hockey","width":665,"height":290,"kickOffRadius":80,"cornerRadius":0},"vertexes":[{"x":-665,"y":290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-665,"y":80,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-665,"y":-80,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-665,"y":-290,"trait":"ballArea","bCoef":1,"cMask":["ball"]},{"x":665,"y":290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":665,"y":80,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":665,"y":-80,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":665,"y":-290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":0,"y":306,"trait":"kickOffBarrier"},{"x":0,"y":80,"trait":"kickOffBarrier"},{"x":0,"y":-80,"trait":"line"},{"x":0,"y":-306,"trait":"kickOffBarrier"},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":-693,"y":-80},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":693,"y":-80},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":-693,"y":80},{"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","x":693,"y":80},{"trait":"line","x":-665,"y":-215},{"trait":"line","x":-500,"y":-50},{"trait":"line","x":665,"y":-215},{"trait":"line","x":500,"y":-50},{"trait":"line","x":-665,"y":215},{"trait":"line","x":-500,"y":50},{"trait":"line","x":665,"y":215},{"trait":"line","x":500,"y":50},{"bCoef":1,"trait":"ballArea","x":665,"y":290},{"bCoef":1,"trait":"ballArea","x":665,"y":-290},{"bCoef":0,"trait":"line","x":0,"y":290},{"bCoef":0,"trait":"line","x":0,"y":-290},{"x":0,"y":80,"trait":"kickOffBarrier"},{"x":0,"y":-80,"trait":"kickOffBarrier"},{"x":674,"y":-80,"trait":"line","cMask":["ball"],"bCoef":1},{"x":674,"y":-290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-674,"y":-80,"trait":"line","cMask":["ball"],"bCoef":1},{"x":-674,"y":-290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":-674,"y":80,"trait":"line","cMask":["ball"],"bCoef":1},{"x":-674,"y":290,"trait":"ballArea","cMask":["ball"],"bCoef":1},{"x":674,"y":80,"trait":"line","cMask":["ball"],"bCoef":1},{"x":674,"y":290,"trait":"ballArea","cMask":["ball"],"bCoef":1}],"segments":[{"v0":0,"v1":1,"trait":"ballArea"},{"v0":2,"v1":3,"trait":"ballArea"},{"v0":4,"v1":5,"trait":"ballArea"},{"v0":6,"v1":7,"trait":"ballArea"},{"v0":8,"v1":9,"trait":"kickOffBarrier"},{"v0":9,"v1":10,"trait":"kickOffBarrier","curve":180,"cGroup":["blueKO"]},{"v0":9,"v1":10,"trait":"kickOffBarrier","curve":-180,"cGroup":["redKO"]},{"v0":10,"v1":11,"trait":"kickOffBarrier"},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":2,"v1":12,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":6,"v1":13,"color":"FFFFFF","curve":35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":1,"v1":14,"color":"FFFFFF","curve":35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":5,"v1":15,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":12,"v1":14,"x":-585,"color":"FFFFFF","curve":-35},{"vis":true,"bCoef":0.1,"cMask":["ball"],"trait":"goalNet","v0":13,"v1":15,"x":585,"color":"FFFFFF","curve":35},{"color":"FFFFFF","trait":"line","v0":16,"v1":17,"curve":90},{"color":"FFFFFF","trait":"line","v0":18,"v1":19,"curve":-90},{"color":"FFFFFF","trait":"line","v0":20,"v1":21,"curve":-90},{"color":"FFFFFF","trait":"line","v0":22,"v1":23,"curve":90},{"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":17,"v1":21,"curve":0},{"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":19,"v1":23,"curve":0},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":1,"v1":0,"cMask":["ball"],"x":-665},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":5,"v1":4,"cMask":["ball"],"x":665},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":2,"v1":3,"cMask":["ball"],"x":-665},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":6,"v1":7,"cMask":["ball"],"x":665},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":0,"v1":24,"y":290},{"vis":true,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":3,"v1":25,"y":-290},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":26,"v1":27},{"curve":-180,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":10,"v1":9},{"curve":180,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":29,"v1":28},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":2,"v1":1},{"curve":0,"vis":true,"color":"FFFFFF","bCoef":0,"trait":"line","v0":6,"v1":5},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":30,"v1":31,"cMask":["ball"],"x":614},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":32,"v1":33,"cMask":["ball"],"x":-614},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":34,"v1":35,"cMask":["ball"],"x":-614},{"vis":false,"color":"FFFFFF","bCoef":1,"trait":"ballArea","v0":36,"v1":37,"cMask":["ball"],"x":614}],"goals":[{"p0":[-674,-80],"p1":[-674,80],"team":"red"},{"p0":[674,80],"p1":[674,-80],"team":"blue"}],"discs":[{"pos":[-665,80],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[-665,-80],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[665,80],"trait":"goalPost","color":"FFFFFF","radius":5},{"pos":[665,-80],"trait":"goalPost","color":"FFFFFF","radius":5}],"planes":[{"normal":[0,1],"dist":-290,"trait":"ballArea"},{"normal":[0,-1],"dist":-290,"trait":"ballArea"},{"normal":[0,1],"dist":-339,"bCoef":0.2,"cMask":["all"]},{"normal":[0,-1],"dist":-339,"bCoef":0.2,"cMask":["all"]},{"normal":[1,0],"dist":-755,"bCoef":0.2,"cMask":["all"]},{"normal":[-1,0],"dist":-755,"bCoef":0.2,"cMask":["all"]}],"traits":{"ballArea":{"vis":false,"bCoef":1,"cMask":["ball"]},"goalPost":{"radius":8,"invMass":0,"bCoef":1},"goalNet":{"vis":true,"bCoef":0.1,"cMask":["all"]},"kickOffBarrier":{"vis":false,"bCoef":0.1,"cGroup":["redKO","blueKO"],"cMask":["red","blue"]},"line":{"vis":true,"bCoef":0,"cMask":[""]},"arco":{"radius":2,"cMask":["n\/d"],"color":"cccccc"}},"playerPhysics":{"acceleration":0.11,"kickingAcceleration":0.1,"kickStrength":7},"ballPhysics":{"radius":6.4,"color":"9CF0E5"}}'
const ROOM_CONFIG = {
    roomName: " etu | Futsal - Sniper - Power | 24/7",
    maxPlayers: 12,
    public: true,
    noPlayer: true, 
    token: "" 
};

const GAME_CONFIG = {
    welcomeMessage: "",
};

const ADMIN_LIST = [
    "etu",
];

const TEAM = {
    RED: 1,
    BLUE: 2,
    SPEC: 3
}

const HP_PLAYERS = [
    "etu",
];

const FRIENDS = [

]

const LOVE = [

]

const BADGES = {
    ADMIN: '',
    HP: '',
    AUTHENTICATED: '',
    FRIEND: '',
    LOVE: '',
};

const GAME_STATES = {
    PRACTICE: 'practice',
    MATCH: 'match'
}; 

class Events {
    constructor() {
        this.listeners = new Map();
    }

    register(eventName, callback) {
        if (!this.listeners.has(eventName)) {
            this.listeners.set(eventName, new Set());
        }
        this.listeners.get(eventName).add(callback);
    }

    unregister(eventName, callback) {
        if (this.listeners.has(eventName)) {
            this.listeners.get(eventName).delete(callback);
        }
    }

    dispatch(eventName, data) {
        if (this.listeners.has(eventName)) {
            for (const callback of this.listeners.get(eventName)) {
                callback(data);
            }
        }
    }
}

class Database {
    constructor() {
        this.storage = window.localStorage;
        this.initializeStorage();
    }

    initializeStorage() {
        if (!this.storage.getItem('users')) {
            this.storage.setItem('users', JSON.stringify({}));
        }
    }

    getUsers() {
        return JSON.parse(this.storage.getItem('users'));
    }

    saveUsers(users) {
        this.storage.setItem('users', JSON.stringify(users));
    }

    getUserByName(name) {
        const users = this.getUsers();
        return Object.values(users).find(user => user.name.toLowerCase() === name.toLowerCase());
    }

    createUser(auth, name, password) {
        const users = this.getUsers();
        
        if (this.getUserByName(name)) {
            return null;
        }

        users[name.toLowerCase()] = {
            name,
            password,
            registered: Date.now(),
            lastLogin: Date.now(),
            stats: {
                wins: 0,
                losses: 0,
                goals: 0,
                assists: 0
            }
        };
        this.saveUsers(users);
        return users[name.toLowerCase()];
    }

    updateUser(name, updates) {
        const users = this.getUsers();
        const lowerName = name.toLowerCase();
        if (users[lowerName]) {
            users[lowerName] = { ...users[lowerName], ...updates };
            this.saveUsers(users);
            return users[lowerName];
        }
        return null;
    }
}

class GameEvents {
    constructor(room) {
        this.room = room;
        this.events = new Events();
        this.db = new Database();
        this.players = new Map();
        this.loginTimers = new Map();
        this.activeVote = null;
        this.votes = new Map();
        this.initializeEvents();
    }

    startLoginTimer(playerId) {
        const LOGIN_TIMEOUT = 15000;
        
        if (this.loginTimers.has(playerId)) {
            clearTimeout(this.loginTimers.get(playerId));
        }

        const timer = setTimeout(() => {
            const player = this.players.get(playerId);
            const user = this.db.getUserByName(player.name);
            if (player && !player.loggedIn && user) {
                this.room.kickPlayer(
                    playerId,
                    "Giri yapmadnz iin odadan atldnz! Ltfen tekrar giri yapn.",
                    false
                );
            }
            this.loginTimers.delete(playerId);
        }, LOGIN_TIMEOUT);

        this.loginTimers.set(playerId, timer);
    }

    sendToPlayer(message, playerId, color = 0x00FF00, style = "bold", sound = 2) {
        this.room.sendAnnouncement(message, playerId, color, style, sound);
    }

    sendToAll(message, color = 0x00FF00, style = "bold", sound = 2) {
        this.room.sendAnnouncement(message, null, color, style, sound);
    }

    setCustomMap(map) {
        this.room.setCustomStadium(map);
    }

    initializeEvents() {
        this.room.onPlayerJoin = (player) => {
            const existingPlayer = Array.from(this.players.values()).find(p => 
                p.name.toLowerCase() === player.name.toLowerCase() && p.id !== player.id
            );
            
            if (existingPlayer) {
                this.room.kickPlayer(player.id, "Ayn kullanc adna sahip bir oyuncu zaten oyunda!", false);
                return;
            }

            this.players.set(player.id, {
                ...player,
                loggedIn: false
            });
            
            this.events.dispatch('playerJoin', player);

            const playerData = this.players.get(player.id);
            if (!playerData.auth) {
                this.sendToPlayer(
                    'Odaya giri yapabilmek iin ltfen https://haxbal.com/auth-player adresindeki "Auth Key" alanndaki deeri taraycnzn depolama alanna kopyalaynz.',
                    player.id,
                    0xFF0000,
                    "small-bold",
                    2
                );
                return;
            }

            const user = this.db.getUserByName(playerData.name);
            if (!user) {
                this.sendToPlayer(
                    `Hogeldin! Profiliniz yklenemedi. Ltfen !kayt <ifre> komutu kullanarak profilinizi oluturun.`,
                    player.id,
                    0xFFA500,
                    "small-bold",
                    2
                );
            } else {
                this.sendToPlayer(
                    `Tekrar hogeldiniz! Ltfen !giri <ifre> komutu kullanarak profilinize giri yapn.`,
                    player.id,
                    0x00FF00,
                    "small-bold",
                    2
                );
                this.db.updateUser(user.name, { lastSeen: Date.now() });
            }

            this.startLoginTimer(player.id);

            this.sendToPlayer(
                "NOT: Sunucumuz gelitirilme srecindedir. Ltfen karlatnz hatalar bize bildiriniz.",
                player.id,
                0xFF0000,
                "small-italic",
            );
        };

        this.room.onPlayerLeave = (player) => {
            if (this.loginTimers.has(player.id)) {
                clearTimeout(this.loginTimers.get(player.id));
                this.loginTimers.delete(player.id);
            }
            
            this.events.dispatch('playerLeave', player);
            this.players.delete(player.id);
        };

        this.room.onPlayerBallKick = (player) => {
            const now = Date.now();
            
            if (this.lastKicker !== player.id) {
                this.secondLastKicker = this.lastKicker;
                this.lastKicker = player.id;
                this.lastKickTime = now;
            }
        };
    }

    getPlayer(playerId) {
        return this.players.get(playerId);
    }

    setPlayerLoggedIn(playerId, status) {
        const player = this.players.get(playerId);
        if (player) {
            player.loggedIn = status;
            if (status) {
                if (this.loginTimers.has(playerId)) {
                    clearTimeout(this.loginTimers.get(playerId));
                    this.loginTimers.delete(playerId);
                }
                
                if (ADMIN_LIST.includes(player.name)) {
                    this.room.setPlayerAdmin(playerId, true);
                }
            }
            this.players.set(playerId, player);
        }
    }

    isAdmin(playerId) {
        const player = this.players.get(playerId);
        return player && ADMIN_LIST.includes(player.name);
    }

    startVote(options, duration = 30000) {
        if (this.activeVote) {
            return false;
        }

        this.activeVote = {
            options,
            startTime: Date.now(),
            endTime: Date.now() + duration
        };
        this.votes.clear();

        setTimeout(() => {
            if (this.activeVote) {
                this.endVote();
            }
        }, duration);

        return true;
    }

    endVote() {
        if (!this.activeVote) {
            return null;
        }

        const results = new Map();
        this.activeVote.options.forEach(option => {
            results.set(option, 0);
        });

        this.votes.forEach(vote => {
            results.set(vote, results.get(vote) + 1);
        });

        const totalVotes = this.votes.size;
        let winner = null;
        let maxVotes = 0;

        results.forEach((votes, option) => {
            if (votes > maxVotes) {
                maxVotes = votes;
                winner = option;
            }
        });

        const voteResults = {
            winner,
            totalVotes,
            results: Object.fromEntries(results),
            percentages: Object.fromEntries(
                Array.from(results.entries()).map(([option, votes]) => [
                    option,
                    totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0
                ])
            )
        };

        this.activeVote = null;
        this.votes.clear();

        return voteResults;
    }
}

class Commands {
    constructor(room, gameEvents) {
        this.room = room;
        this.gameEvents = gameEvents;
        this.commands = new Map();
        this.prefix = '!';
        this.publicCommands = ['kayt', 'giri'];
        this.initializeCommandHandler();
    }

    register(command, {
        handler,
        description = 'Aklama yok.',
        usage = '',
        minArgs = 0,
        maxArgs = Infinity,
        permissions = null
    }) {
        this.commands.set(command.toLowerCase(), {
            handler,
            description,
            usage,
            minArgs,
            maxArgs,
            permissions
        });
    }

    initializeCommandHandler() {
        this.room.onPlayerChat = (player, message) => {
            if (message.startsWith(this.prefix)) {
                const [commandName, ...args] = message.slice(this.prefix.length).split(' ');
                const command = this.commands.get(commandName.toLowerCase());

                if (!command) {
                    return false;
                }

                const playerData = this.gameEvents.getPlayer(player.id);
                const isPublicCommand = this.publicCommands.includes(commandName.toLowerCase());
                
                if (playerData.loggedIn && ['giri', 'kayt'].includes(commandName.toLowerCase())) {
                    this.gameEvents.sendToPlayer(
                        'Zaten giri yapm durumdasnz!',
                        player.id,
                        0xFF0000,
                        "small-bold",
                        2
                    );
                    return false;
                }

                if (!isPublicCommand) {
                    if (!playerData || !playerData.auth) {
                        this.gameEvents.sendToPlayer(
                            'Odaya giri yapabilmek iin ltfen https://haxbal.com/auth-player adresindeki "Auth Key" alanndaki deeri taraycnzn depolama alanna kopyalaynz.',
                            player.id,
                            0xFF0000,
                            "small-bold",
                            2
                        );
                        return;
                    }

                    if (!playerData.loggedIn) {
                        this.gameEvents.sendToPlayer(
                            'Bu komutu kullanabilmek iin giri yapmanz gerekmektedir. Ltfen !giri <ifre> komutunu kullann.',
                            player.id,
                            0xFF0000,
                            "small-bold",
                            2
                        );
                        return false;
                    }
                }

                if (args.length < command.minArgs || args.length > command.maxArgs) {
                    this.gameEvents.sendToPlayer(
                        `Geersiz kullanm. Kullanm: ${this.prefix}${commandName} ${command.usage}`,
                        player.id,
                        0xFF0000,
                        "small-bold",
                        2
                    );
                    return;
                }

                if (command.permissions && !command.permissions(player)) {
                    this.gameEvents.sendToPlayer(
                        'Bu komutu kullanmak iin yeterli yetkiniz yok.',
                        player.id,
                        0xFF0000,
                        "small-bold",
                        2
                    );
                    return;
                }

                command.handler(player, args);
                return false;
            }

            const playerData = this.gameEvents.getPlayer(player.id);
            const user = this.gameEvents.db.getUserByName(playerData.name);
            
            if (user && !playerData.loggedIn) {
                this.gameEvents.sendToPlayer(
                    'Sohbet edebilmek iin giri yapmanz gerekmektedir. Ltfen !giri <ifre> komutunu kullann.',
                    player.id,
                    0xFF0000,
                    "small-bold",
                    2
                );
                return false;
            }

            const badges = [];
            if (this.gameEvents.isAdmin(player.id)) {
                badges.push(BADGES.ADMIN);
            }
            if (HP_PLAYERS.includes(player.name)) {
                badges.push(BADGES.HP);
            }
            if (playerData.loggedIn) {
                badges.push(BADGES.AUTHENTICATED);
            }

            const badgePrefix = badges.length > 0 ? badges.join('') + ' ' : '';
            const color = this.gameEvents.isAdmin(player.id) ? 0xFF6666 : 0xFFFFFF;
            
            this.gameEvents.sendToAll(
                `${badgePrefix}${player.name}: ${message}`,
                color,
                badges.length > 0 ? "small-bold" : "small",
                1
            );

            return false;
        };
    }

    help(command) {
        if (command) {
            const cmd = this.commands.get(command.toLowerCase());
            if (!cmd) return `err: komut bulunamadis`;
            return `${this.prefix}${command} ${cmd.usage}\n${cmd.description}`;
        }

        return Array.from(this.commands.entries())
            .map(([name, cmd]) => `${this.prefix}${name}: ${cmd.description}`)
            .join('\n');
    }
}

let room = HBInit(ROOM_CONFIG);

if (!room) {
    console.error("err: oda yok :d");
    process.exit(1);
}

const gameEvents = new GameEvents(room);
const commands = new Commands(room, gameEvents);

commands.register('yardm', {
    handler: (player, args) => {
        const helpText = args[0] ? commands.help(args[0]) : commands.help();
        gameEvents.sendToPlayer(helpText, player.id);
    },
    description: 'Btn komutlar grntleyin veya belirli bir komuta yardm aln.',
    usage: '[komut]',
    maxArgs: 1
});

commands.register('kayt', {
    handler: (player, [password]) => {
        const playerData = gameEvents.getPlayer(player.id);
        if (!playerData || !playerData.auth) {
            gameEvents.sendToPlayer(
                'Odaya giri yapabilmek iin ltfen https://haxbal.com/auth-player adresindeki "Auth Key" alanndaki deeri taraycnzn depolama alanna kopyalaynz.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        if (gameEvents.db.getUserByName(playerData.name)) {
            gameEvents.sendToPlayer(
                'Bu kullanc ad zaten kaytl! Ltfen farkl bir ad kullann.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        if (!password || password.length < 4) {
            gameEvents.sendToPlayer(
                'ifre en az 4 karakter olmaldr.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        const user = gameEvents.db.createUser(playerData.auth, playerData.name, password);
        if (!user) {
            gameEvents.sendToPlayer(
                'Hesap oluturulamad. Kullanc ad zaten alnm olabilir.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        gameEvents.setPlayerLoggedIn(player.id, true);
        gameEvents.sendToPlayer(
            `Profiliniz baaryla oluturuldu! Bundan sonra setiiniz ifre ile giri yapabilirsiniz.`,
            player.id,
            0x00FF00,
            "small-bold",
            2
        );
    },
    description: 'Yeni ifre oluturun.',
    usage: '<ifre>',
    minArgs: 1,
    maxArgs: 1
});

commands.register('at', { // todo: almyor fixle
    // handler: (player, [target, reason]) => {
    //     gameEvents.sendToPlayer(
    //         `${target.name} adl oyuncu sunucudan atld.`, 
    //         null, 
    //         0xFFFFFF, 
    //         "small-bold", 
    //         1
    //     );
    //     room.kickPlayer(target, reason ? reason : "Sebep belirtilmedi.");
    // },
    // description: 'at',
    // usage: '<hedef> <sebep>',
    // minArgs: 1,
    // maxArgs: 1,
    // permissions: (player) => gameEvents.isAdmin(player.id)
});

commands.register('harita', {
    handler: (player, [mapName]) => {
        room.stopGame();
        switch (mapName) {
            case 'golsuz':
                gameEvents.setCustomMap(PRACTICE_MAP);
                break;
            case 'v1':
                gameEvents.setCustomMap(MAP_V1);
                break;
            case 'v2':
                gameEvents.setCustomMap(MAP_V3);
                break;
            case 'v3':
                gameEvents.setCustomMap(MAP_V3);
                break;
            case 'sniper':
                gameEvents.setCustomMap(SNIPER);
                break;
            default:
                gameEvents.sendToPlayer('Geersiz harita ad!', player.id, 0xFF0000, "small-bold", 2);
                return;
        }

        room.startGame();
        room.setPlayerTeam(player.id, 1);

        gameEvents.sendToAll(`Harita baaryla deitirildi: ${mapName}`, 
            0xFFFFFF, 
            "small-bold", 
            1
        );
    },
    description: 'Oyunun haritasn deitirin.',
    usage: '<harita ad>',
    minArgs: 1,
    maxArgs: 1,
    permissions: (player) => gameEvents.isAdmin(player.id)
});

commands.register('giri', {
    handler: (player, [password]) => {
        const playerData = gameEvents.getPlayer(player.id);
        if (!playerData || !playerData.auth) {
            gameEvents.sendToPlayer(
                'Odaya giri yapabilmek iin ltfen https://haxbal.com/auth-player adresindeki "Auth Key" alanndaki deeri taraycnzn depolama alanna kopyalaynz.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        const user = gameEvents.db.getUserByName(playerData.name);
        if (!user) {
            gameEvents.sendToPlayer(
                'Bu kullanc ad ile bir hesap bulunamad! Ltfen !kayt <ifre> <ifre yeniden> komutu kullanarak profilinizi oluturun.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        if (user.password !== password) {
            gameEvents.sendToPlayer(
                'Hatal ifre! Ltfen doru ifreyi kullanarak giri yapn.',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        gameEvents.setPlayerLoggedIn(player.id, true);
        gameEvents.db.updateUser(user.name, { lastLogin: Date.now() });
        gameEvents.sendToPlayer(
            `Profilinize baaryla giri yaptnz! yi oyunlar!`,
            player.id,
            0x00FF00,
            "small-bold",
            2
        );
    },
    description: 'Hesabnza giri yapn',
    usage: '<ifre>',
    minArgs: 1,
    maxArgs: 1
});

commands.register('liste', {
    handler: (player) => {
        const players = Array.from(gameEvents.players.values());
        const admins = players.filter(p => ADMIN_LIST.includes(p.name));
        const regularPlayers = players.filter(p => !ADMIN_LIST.includes(p.name));
        
        let message = `Oyuncu Listesi (${players.length}): `;
        
        if (admins.length > 0) {
            message += admins.map(p => `${p.name} (YETKL)`).join(', ');
            if (regularPlayers.length > 0) {
                message += ', ';
            }
        }
        
        if (regularPlayers.length > 0) {
            if (regularPlayers.length === 1) {
                message += regularPlayers[0].name;
            } else {
                const hepsi = regularPlayers.slice(0, -1);
                const son = regularPlayers[regularPlayers.length - 1];
                message += hepsi.map(p => p.name).join(', ');
                message += ` ve ${son.name}`;
            }
        }
        
        gameEvents.sendToPlayer(message, player.id, 0xFFFFFF, "small-bold");
    },
    description: 'Oyunculari listeleyin'
});

commands.register('oybalat', {
    handler: (player) => {
        if (gameEvents.activeVote) {
            gameEvents.sendToPlayer(
                'Zaten aktif bir oylama var!',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        const options = ['futsal', 'power', 'sniper'];
        const started = gameEvents.startVote(options);

        if (started) {
            gameEvents.sendToAll(
                'Hangisini oynamak istersiniz? Oylamak iin: !oy <futsal/power/sniper>',
                0x00FF00,
                "small-bold",
                2
            );
        }
    },
    description: 'Oyun modu oylamas balatn',
    permissions: (player) => gameEvents.isAdmin(player.id)
});

commands.register('oy', {
    handler: (player, [vote]) => {
        if (!gameEvents.activeVote) {
            gameEvents.sendToPlayer(
                'u anda aktif bir oylama bulunmuyor!',
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        const normalizedVote = vote.toLowerCase();
        if (!gameEvents.activeVote.options.includes(normalizedVote)) {
            gameEvents.sendToPlayer(
                `Geersiz seenek! Ltfen unlardan birini sein: ${gameEvents.activeVote.options.join(', ')}`,
                player.id,
                0xFF0000,
                "small-bold",
                2
            );
            return;
        }

        gameEvents.votes.set(player.id, normalizedVote);
        gameEvents.sendToPlayer(
            `Oyunuzu ${normalizedVote}'dan yana kullandnz!`,
            player.id,
            0x00FF00,
            "small-bold",
            2
        );

        if (gameEvents.votes.size === gameEvents.players.size) {
            const results = gameEvents.endVote();
            _vote_resulst(results);
        }
    },
    description: 'Aktif oylamada oy kullann',
    usage: '<futsal/power/sniper>',
    minArgs: 1,
    maxArgs: 1
});

function _vote_resulst(results) { // todo: GameEvents'e tanacak
    gameEvents.sendToAll(
        `Oylama sonular (Toplam: ${results.totalVotes} oy):`,
        0xFFA500,
        "small-bold",
        2
    );

    const voteResults = Object.entries(results.percentages)
        .map(([option, percentage]) => 
            `${option.charAt(0).toUpperCase() + option.slice(1)}: ${percentage}% (${results.results[option]} oy)`
        )
        .join('\n');
    gameEvents.sendToAll(voteResults, 0xFFFFFF, "small-bold", 2);

    gameEvents.sendToAll(
        `Kazanan: ${results.winner.charAt(0).toUpperCase() + results.winner.slice(1)} `,
        0xFFA500,
        "small-bold",
        2
    );
}

gameEvents.events.register('playerJoin', (player) => {
    console.log(`event dispatch test+: ${player.name}`);
});

gameEvents.events.register('playerLeave', (player) => {
    console.log(`event dispatch test-: ${player.name}`);
});

gameEvents.setCustomMap(PRACTICE_MAP);
